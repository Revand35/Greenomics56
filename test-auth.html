<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth - Greenomics</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">üß™ Test Authentication</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Status</h2>
            <div id="status" class="text-lg">Loading...</div>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">User Data</h2>
            <pre id="userData" class="bg-gray-100 p-4 rounded text-sm overflow-auto"></pre>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Console Logs</h2>
            <div id="logs" class="bg-gray-900 text-green-400 p-4 rounded text-sm max-h-96 overflow-auto font-mono"></div>
        </div>
    </div>

    <script type="module">
        // Capture console logs
        const logsDiv = document.getElementById('logs');
        const originalLog = console.log;
        const originalError = console.error;
        
        function addLog(message, type = 'log') {
            const div = document.createElement('div');
            div.className = type === 'error' ? 'text-red-400' : 'text-green-400';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(div);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        console.log('üöÄ Starting test...');
        
        try {
            console.log('üì¶ Importing Firebase modules...');
            
            // Import Firebase
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
            const { getAuth, onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
            
            console.log('‚úÖ Firebase modules imported');
            
            // Firebase config
            const firebaseConfig = {
                apiKey: "AIzaSyC7vfSi6iGzWSkyWJTX1lvTG-k8P1HZL9s",
                authDomain: "greenomics-7639d.firebaseapp.com",
                projectId: "greenomics-7639d",
                storageBucket: "greenomics-7639d.firebasestorage.app",
                messagingSenderId: "381392746735",
                appId: "1:381392746735:web:c9873f430a5b04c4f5031a"
            };
            
            console.log('üîß Initializing Firebase...');
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            console.log('‚úÖ Firebase initialized');
            
            console.log('üîê Setting up auth listener...');
            onAuthStateChanged(auth, (user) => {
                console.log('üîê Auth state changed');
                
                const statusDiv = document.getElementById('status');
                const userDataDiv = document.getElementById('userData');
                
                if (user) {
                    console.log('‚úÖ User is logged in!');
                    console.log('User UID:', user.uid);
                    console.log('User Email:', user.email);
                    console.log('User Name:', user.displayName);
                    
                    statusDiv.innerHTML = '<span class="text-green-600 font-bold">‚úÖ USER LOGGED IN</span>';
                    
                    userDataDiv.textContent = JSON.stringify({
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        emailVerified: user.emailVerified,
                        creationTime: user.metadata.creationTime,
                        lastSignInTime: user.metadata.lastSignInTime
                    }, null, 2);
                } else {
                    console.log('‚ùå No user logged in');
                    statusDiv.innerHTML = '<span class="text-red-600 font-bold">‚ùå NO USER LOGGED IN</span>';
                    userDataDiv.textContent = 'No user data available';
                }
            });
            
        } catch (error) {
            console.error('‚ùå Error:', error.message);
            console.error('Stack:', error.stack);
            document.getElementById('status').innerHTML = '<span class="text-red-600">ERROR: ' + error.message + '</span>';
        }
    </script>
</body>
</html>